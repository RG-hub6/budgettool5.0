<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Budgettool 5.0</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
body { font-family: Arial, sans-serif; background:#f4f6fb; margin:0; }
header { background:#4f46e5; color:white; padding:15px; text-align:center; }
main { padding:15px; }
.panel { background:white; padding:15px; border-radius:10px; margin-bottom:15px; }
button { padding:6px 10px; border:none; border-radius:6px; cursor:pointer; background:#4f46e5; color:white; }
button.small { font-size:12px; padding:4px 8px; }
input, select { padding:6px; margin:4px 0; }
.tree { margin-left:20px; border-left:2px solid #ddd; padding-left:10px; }
.item { display:flex; gap:6px; align-items:center; margin:4px 0; }
.badge { font-size:11px; background:#e5e7eb; border-radius:6px; padding:2px 6px; }
.income { color:green; }
.expense { color:red; }
canvas { max-width:100%; }
label { margin-right:10px; }
</style>
</head>
<body>
<header>
  <h1>Budgettool 5.0</h1>
  <select id="monthSelect"></select>
</header>

<main>
<div class="panel">
  <h3>Overzicht deze maand</h3>
  <p>Inkomsten: €<span id="inc">0</span></p>
  <p>Uitgaven: €<span id="exp">0</span></p>
  <h3>Saldo: €<span id="bal">0</span></h3>
</div>

<div class="panel">
  <h3>Grafiek (per maand)</h3>
  <label><input type="checkbox" id="showIncome" checked> Inkomsten</label>
  <label><input type="checkbox" id="showExpense" checked> Uitgaven</label>
  <label><input type="checkbox" id="showSaldo" checked> Saldo</label>
  <canvas id="chart"></canvas>
</div>

<div class="panel">
  <h3>Categorieën</h3>
  <button onclick="addCategory()">+ nieuwe categorie</button>
  <div id="categories"></div>
</div>

<script>
const data = { categories: [] };
const months = ["Jan","Feb","Mrt","Apr","Mei","Jun","Jul","Aug","Sep","Okt","Nov","Dec"];
let currentMonth = new Date().getMonth();

/* Maand selectie */
const monthSelect = document.getElementById("monthSelect");
months.forEach((m,i)=>{
  const o=document.createElement("option");
  o.value=i; o.textContent=m;
  monthSelect.appendChild(o);
});
monthSelect.value=currentMonth;
monthSelect.onchange=()=>{ currentMonth=+monthSelect.value; render(); };

/* Categorie & Item functies */
function addCategory(parent){
  const name = prompt("Naam categorie:");
  if(!name) return;
  const cat = { name, children:[], items:[] };
  (parent ? parent.children : data.categories).push(cat);
  render();
}
function addItem(cat){
  const label = prompt("Naam bedrag:");
  if(!label) return;
  const amount = parseFloat(prompt("Bedrag (€):"));
  if(isNaN(amount)) return;
  const type = prompt("inkomen of uitgave","uitgave");
  const freq = prompt("dag / week / maand / jaar / eenmalig","maand");
  cat.items.push({ label, amount, type, freq, startMonth: currentMonth });
  render();
}

/* Berekening per item */
function calcItem(item, month){
  if(month < item.startMonth) return 0;
  switch(item.freq){
    case "dag": return item.amount * 30;
    case "week": return item.amount * 4.33;
    case "maand": return item.amount;
    case "jaar": return item.amount / 12;
    case "eenmalig": return month===item.startMonth ? item.amount : 0;
    default: return 0;
  }
}

/* Berekening totaal per maand */
function sumMonth(month){
  let inc=0, exp=0;
  function walk(cat){
    cat.items.forEach(i=>{
      const v=calcItem(i,month);
      if(i.type==="inkomen") inc+=v; else exp+=v;
    });
    cat.children.forEach(walk);
  }
  data.categories.forEach(walk);
  return {inc, exp, saldo: inc-exp};
}

/* Render categorieën */
function renderCategory(cat, parent){
  const div=document.createElement("div");
  div.className="tree";
  div.innerHTML=`
    <strong>${cat.name}</strong>
    <button class="small" onclick="addItem(ref)">+ bedrag</button>
    <button class="small" onclick="addCategory(ref)">+ subcategorie</button>
  `;
  parent.appendChild(div);
  cat.items.forEach(i=>{
    const el=document.createElement("div");
    el.className="item";
    el.innerHTML=`<span>${i.label}</span>
      <span class="badge">${i.freq}</span>
      <span class="${i.type==="inkomen"?"income":"expense"}">€${calcItem(i,currentMonth).toFixed(2)}</span>`;
    div.appendChild(el);
  });
  cat.children.forEach(c=>{
    window.ref=c;
    renderCategory(c, div);
  });
}

/* Grafiek */
let chart;
function renderChart(){
  const inc=[], exp=[], saldo=[];
  for(let m=0;m<12;m++){
    const r=sumMonth(m);
    inc.push(r.inc); exp.push(r.exp); saldo.push(r.saldo);
  }
  if(chart) chart.destroy();
  const datasets=[];
  if(document.getElementById("showIncome").checked)
    datasets.push({label:"Inkomsten", data:inc, backgroundColor:"green"});
  if(document.getElementById("showExpense").checked)
    datasets.push({label:"Uitgaven", data:exp, backgroundColor:"red"});
  if(document.getElementById("showSaldo").checked)
    datasets.push({label:"Saldo", data:saldo, backgroundColor:"blue"});
  chart=new Chart(document.getElementById("chart"),{ type:"bar", data:{ labels:months, datasets:datasets }});
}

/* Checkbox events */
document.getElementById("showIncome").addEventListener("change", renderChart);
document.getElementById("showExpense").addEventListener("change", renderChart);
document.getElementById("showSaldo").addEventListener("change", renderChart);

/* Render alles */
function render(){
  const r=sumMonth(currentMonth);
  document.getElementById("inc").textContent=r.inc.toFixed(2);
  document.getElementById("exp").textContent=r.exp.toFixed(2);
  document.getElementById("bal").textContent=r.saldo.toFixed(2);

  const root=document.getElementById("categories");
  root.innerHTML="";
  data.categories.forEach(c=>{ window.ref=c; renderCategory(c,root); });
  renderChart();
}

setTimeout(()=>render(),100);
</script>
</body>
</html>
